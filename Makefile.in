# Check for a .configured file generated by configure script
ifeq ($(wildcard .configured),)
$(error You must run `./configure` before you can build.)
endif

CC = @CC@

CPPFLAGS ?= 
CFLAGS ?=
LDFLAGS ?=
PREFIX ?= @PREFIX@
GNSRCDIR ?= /tmp/e10b5eccac1ecb4e8706e3898719b197a1e9d10d65e860192d38155cb31233ea

all: build

build: libmysolvers.h libmysolvers.c libcharge.h libcharge.c
	mkdir -p obj
	$(CC) $(CFLAGS) -c libmysolvers.c -o obj/libmysolvers.o
	$(CC) $(CFLAGS) -c libcharge.c -o obj/libcharge.o
	ar rcs obj/libmysolvers.a obj/libmysolvers.o
	ar rcs obj/libcharge.a obj/libcharge.o

install:
	mkdir -p $(PREFIX)/include
	mkdir -p $(PREFIX)/lib
	cp libmysolvers.h $(PREFIX)/include/
	cp libcharge.h $(PREFIX)/include/
	cp obj/libmysolvers.a $(PREFIX)/lib/
	cp obj/libcharge.a $(PREFIX)/lib/

clean:
	rm -rf obj

uninstall:
	rm -rf $(PREFIX)/include/libmysolvers.h
	rm -rf $(PREFIX)/include/libcharge.h
	rm -rf $(PREFIX)/lib/libmysolvers.a
	rm -rf $(PREFIX)/lib/libcharge.a

dist: clean
	rm -rf $(GNSRCDIR)
	cp -R . $(GNSRCDIR)
	mkdir -p dist
	find $(GNSRCDIR) -type d -name ".git" -print
	find $(GNSRCDIR) -type d -name ".git" -exec rm -rf {} +
	tar -cvJf dist/libmysovers.tar.xz -C $(GNSRCDIR) .
	rm -rf $(GNSRCDIR)

.PHONY: all build clean install uninstall dist